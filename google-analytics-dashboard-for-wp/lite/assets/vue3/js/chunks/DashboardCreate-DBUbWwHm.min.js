import{c as e,a as s,e as a,f as t,g as o,t as i,n,h as l,r,u as d,_ as u,b as c,w as g,v as m,i as p,j as v,k as w,T as h,l as f,m as y,p as b,F as C,q as _,s as k,o as S,x,y as M,d as D}from"../custom-dashboard.min.js";import{u as O,d as E,a as T,c as V,V as L,_ as I,b as R,e as j,A,R as B,f as P}from"./useAuthGate-DonjFFra.min.js";import{I as U,b as z,u as W,a as N,U as G}from"./useSampleData-Q--2CBsq.min.js";const $={class:"exactmetrics-widget-item__name"},q={__name:"WidgetItem",props:{widget:{type:Object,required:!0}},emits:["drag"],setup(l,{emit:r}){const d=r;function u(e){d("drag",e)}return(r,d)=>(s(),e("div",{class:n(["exactmetrics-widget-item",{"exactmetrics-widget-item--selected":l.widget.selected}]),draggable:"true",onDragstart:u},[l.widget.icon?(s(),a(U,{key:0,name:l.widget.icon,size:16},null,8,["name"])):t("",!0),o("span",$,i(l.widget.name),1)],34))}},F=["aria-label","title"],K={class:"exactmetrics-widget-sidebar__content"},Y={key:0,class:"exactmetrics-widget-search"},H=["placeholder"],J={class:"exactmetrics-widget-sections"},Q={key:0,class:"exactmetrics-widget-group"},X={class:"exactmetrics-widget-group__title"},Z={key:1,class:"exactmetrics-widget-group"},ee={class:"exactmetrics-widget-group__title"},se={key:2,class:"exactmetrics-widget-group"},ae={class:"exactmetrics-widget-group__title"},te={key:3,class:"exactmetrics-widget-group"},oe={class:"exactmetrics-widget-group__title"},ie={__name:"WidgetsSidebar",setup(a){const v=O(),w=z(),h=l(()=>"Lite"===w.activeLicenseType||!w.activeLicenseType),f=r(""),y=r(!1);function b(){y.value=!y.value}const C=l(()=>Object.entries(v.widgetMetadata).filter(([e,s])=>s.category===u("Key Metrics","google-analytics-dashboard-for-wp")).map(([e,s])=>({id:e,name:s.title,icon:s.icon||"icons/datetime"}))),_=l(()=>Object.entries(v.widgetMetadata).filter(([e,s])=>s.category===u("Traffic Source","google-analytics-dashboard-for-wp")).map(([e,s])=>({id:e,name:s.title,icon:s.icon||"icons/page-search"}))),k=l(()=>Object.entries(v.widgetMetadata).filter(([e,s])=>s.category===u("Custom Dimensions","google-analytics-dashboard-for-wp")).map(([e,s])=>({id:e,name:s.title,icon:s.icon||"icons/category"}))),S=l(()=>Object.entries(v.widgetMetadata).filter(([e,s])=>s.category===u("Traffic","google-analytics-dashboard-for-wp")).map(([e,s])=>({id:e,name:s.title,icon:s.icon||"icons/web-asset"}))),x=l(()=>C.value.filter(e=>e.name.toLowerCase().includes(f.value.toLowerCase()))),M=l(()=>_.value.filter(e=>e.name.toLowerCase().includes(f.value.toLowerCase()))),D=l(()=>k.value.filter(e=>e.name.toLowerCase().includes(f.value.toLowerCase()))),T=l(()=>S.value.filter(e=>e.name.toLowerCase().includes(f.value.toLowerCase())));function V(e){const s=e.id,a=v.getWidgetByType(s),t=(null==a?void 0:a.title)||s,o=(null==a?void 0:a.defaults)||{},{type:i,...n}=o,l=o.type||"infobox";let r=1;"table"===l?r=3:"line-chart"!==l&&"bar-chart"!==l&&"pie-chart"!==l||(r=2);return{...e,id:`${s}-${Date.now()}`,type:s,title:t,displayType:l,...n,position:{x:0,y:0,w:1,h:r}}}return(a,l)=>(s(),e("div",{class:n(["exactmetrics-widget-sidebar",{"exactmetrics-widget-sidebar--collapsed":y.value}])},[o("button",{class:"exactmetrics-widget-sidebar__toggle","aria-label":y.value?d(u)("Expand sidebar","google-analytics-dashboard-for-wp"):d(u)("Collapse sidebar","google-analytics-dashboard-for-wp"),title:y.value?d(u)("Expand sidebar","google-analytics-dashboard-for-wp"):d(u)("Collapse sidebar","google-analytics-dashboard-for-wp"),onClick:b},[(s(),e("svg",{class:n(["exactmetrics-widget-sidebar__toggle-icon",{"exactmetrics-widget-sidebar__toggle-icon--collapsed":y.value}]),width:"8",height:"14",viewBox:"0 0 8 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[...l[1]||(l[1]=[o("path",{d:"M1 1L7 7L1 13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2))],8,F),o("div",K,[h.value?t("",!0):(s(),e("div",Y,[c(U,{name:"search",size:20}),g(o("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>f.value=e),type:"text",placeholder:d(u)("Search Widget","google-analytics-dashboard-for-wp")},null,8,H),[[m,f.value]])])),o("div",J,[x.value.length?(s(),e("div",Q,[o("h3",X,i(d(u)("Key Metrics","google-analytics-dashboard-for-wp")),1),c(d(E),{"model-value":x.value,"item-key":"id",class:"exactmetrics-widget-group__items",group:{name:"widgets",pull:"clone",put:!1},sort:!1,clone:V},{item:p(({element:e})=>[c(q,{widget:e},null,8,["widget"])]),_:1},8,["model-value"])])):t("",!0),M.value.length?(s(),e("div",Z,[o("h3",ee,i(d(u)("Traffic Source","google-analytics-dashboard-for-wp")),1),c(d(E),{"model-value":M.value,"item-key":"id",class:"exactmetrics-widget-group__items",group:{name:"widgets",pull:"clone",put:!1},sort:!1,clone:V},{item:p(({element:e})=>[c(q,{widget:e},null,8,["widget"])]),_:1},8,["model-value"])])):t("",!0),D.value.length?(s(),e("div",se,[o("h3",ae,i(d(u)("Custom Dimensions","google-analytics-dashboard-for-wp")),1),c(d(E),{"model-value":D.value,"item-key":"id",class:"exactmetrics-widget-group__items",group:{name:"widgets",pull:"clone",put:!1},sort:!1,clone:V},{item:p(({element:e})=>[c(q,{widget:e},null,8,["widget"])]),_:1},8,["model-value"])])):t("",!0),T.value.length?(s(),e("div",te,[o("h3",oe,i(d(u)("Traffic","google-analytics-dashboard-for-wp")),1),c(d(E),{"model-value":T.value,"item-key":"id",class:"exactmetrics-widget-group__items",group:{name:"widgets",pull:"clone",put:!1},sort:!1,clone:V},{item:p(({element:e})=>[c(q,{widget:e},null,8,["widget"])]),_:1},8,["model-value"])])):t("",!0)])])],2))}},ne={class:"exactmetrics-modal-content"},le={class:"exactmetrics-modal-header"},re=["aria-label"],de=["aria-label"],ue={class:"exactmetrics-modal-body"},ce={class:"exactmetrics-radio-label"},ge=["value","checked","disabled","onChange"],me={class:"exactmetrics-radio-text"},pe={class:"exactmetrics-checkbox-label"},ve=["value","checked","disabled","onChange"],we={class:"exactmetrics-checkbox-text"},he={class:"exactmetrics-modal-footer"},fe=v({__name:"EditMetricsModal",props:{isOpen:{type:Boolean,default:!1},widget:{type:Object,default:null},widgetMetadata:{type:Object,default:null}},emits:["close","apply"],setup(g,{emit:m}){const v=g,k=m,S=r([]);w(()=>v.widget,e=>{e&&e.metrics?S.value=[...e.metrics]:e&&(S.value=[])},{immediate:!0});const x=l(()=>{var e,s,a;return(null==(e=v.widget)?void 0:e.displayType)||(null==(a=null==(s=v.widgetMetadata)?void 0:s.defaults)?void 0:a.type)||"infobox"}),M=l(()=>{var e,s;const a=null==(s=null==(e=v.widgetMetadata)?void 0:e.support)?void 0:s.metricSelection;if(!a)return!1;const t=x.value;return"object"!=typeof a||Array.isArray(a)?"single"===a:"single"===a[t]}),D=l(()=>{if(!v.widgetMetadata||!v.widgetMetadata.support)return[];const e=y(v.widgetMetadata.support,x.value).metrics,s={sessions:u("Sessions","google-analytics-dashboard-for-wp"),activeUsers:u("Users","google-analytics-dashboard-for-wp"),screenPageViews:u("Views","google-analytics-dashboard-for-wp"),engagementRate:u("Engagement Rate","google-analytics-dashboard-for-wp"),engagedSessions:u("Engaged Sessions","google-analytics-dashboard-for-wp"),conversions:u("Conversions","google-analytics-dashboard-for-wp"),conversionRate:u("Conversion Rate","google-analytics-dashboard-for-wp"),totalRevenue:u("Revenue","google-analytics-dashboard-for-wp"),bounceRate:u("Bounce Rate","google-analytics-dashboard-for-wp"),averageSessionDuration:u("Avg Session Duration","google-analytics-dashboard-for-wp"),newUsers:u("New Users","google-analytics-dashboard-for-wp"),transactions:u("Purchases","google-analytics-dashboard-for-wp")};return e.map(e=>({value:e,label:s[e]||e,disabled:!1}))});function O(e){return S.value.includes(e)}function E(){k("close")}function T(){k("apply",{widgetId:v.widget.id,metrics:S.value}),k("close")}return(l,r)=>(s(),a(f,{to:"body"},[c(h,{name:"modal-fade"},{default:p(()=>[g.isOpen?(s(),e("div",{key:0,class:"exactmetrics-modal-overlay",onClick:b(E,["self"])},[o("div",ne,[o("div",le,[o("button",{class:"exactmetrics-modal-back",onClick:E,"aria-label":d(u)("Back","google-analytics-dashboard-for-wp")},[c(U,{name:"arrow-left",size:16})],8,re),o("h3",null,i(d(u)("Customize Metrics","google-analytics-dashboard-for-wp")),1),o("button",{class:"exactmetrics-modal-close",onClick:E,"aria-label":d(u)("Close","google-analytics-dashboard-for-wp")},[c(U,{name:"close",size:16})],8,de)]),r[0]||(r[0]=o("div",{class:"exactmetrics-modal-divider"},null,-1)),o("div",ue,[M.value?(s(!0),e(C,{key:0},_(D.value,a=>(s(),e("div",{key:a.value,class:n(["exactmetrics-metric-option",{"exactmetrics-metric-option--disabled":a.disabled}])},[o("label",ce,[o("input",{type:"radio",value:a.value,checked:O(a.value),disabled:a.disabled,onChange:e=>{return s=a.value,void(S.value=[s]);var s},class:"exactmetrics-radio",name:"metric-selection"},null,40,ge),o("span",me,i(a.label),1)])],2))),128)):(s(!0),e(C,{key:1},_(D.value,a=>(s(),e("div",{key:a.value,class:n(["exactmetrics-metric-option",{"exactmetrics-metric-option--disabled":a.disabled}])},[o("label",pe,[o("input",{type:"checkbox",value:a.value,checked:O(a.value),disabled:a.disabled,onChange:e=>function(e){const s=S.value.indexOf(e);s>-1?S.value.splice(s,1):S.value.push(e)}(a.value),class:"exactmetrics-checkbox"},null,40,ve),o("span",we,i(a.label),1)])],2))),128))]),o("div",he,[o("button",{class:"exactmetrics-button exactmetrics-button--secondary",onClick:E},i(d(u)("Cancel","google-analytics-dashboard-for-wp")),1),o("button",{class:"exactmetrics-button exactmetrics-button--primary",onClick:T},i(d(u)("Apply","google-analytics-dashboard-for-wp")),1)])])])):t("",!0)]),_:1})]))}},[["__scopeId","data-v-b0b3aae7"]]),ye={class:"exactmetrics-modal-content"},be={class:"exactmetrics-modal-header"},Ce=["aria-label"],_e=["aria-label"],ke={class:"exactmetrics-modal-body"},Se={class:"exactmetrics-modal-description"},xe={class:"exactmetrics-radio-label"},Me=["value","checked","onChange"],De={class:"exactmetrics-radio-text"},Oe={class:"exactmetrics-modal-footer"},Ee=v({__name:"EditDimensionsModal",props:{isOpen:{type:Boolean,default:!1},widget:{type:Object,default:null},widgetMetadata:{type:Object,default:null}},emits:["close","apply"],setup(n,{emit:g}){const m=n,v=g,k=r("");w(()=>m.widget,e=>{var s,a;e&&e.dimensions&&e.dimensions.length>0?k.value=e.dimensions[0]:(null==(a=null==(s=m.widgetMetadata)?void 0:s.defaults)?void 0:a.dimensions)&&(k.value=m.widgetMetadata.defaults.dimensions[0])},{immediate:!0});const S=l(()=>{var e,s;if(!m.widgetMetadata)return[];const a=(null==(e=m.widget)?void 0:e.displayType)||(null==(s=m.widgetMetadata.defaults)?void 0:s.type)||"table",t=y(m.widgetMetadata.support,a).dimensions||[],o={sessionSource:u("Source","google-analytics-dashboard-for-wp"),sessionMedium:u("Medium","google-analytics-dashboard-for-wp"),sessionDefaultChannelGrouping:u("Channel Grouping","google-analytics-dashboard-for-wp"),country:u("Country","google-analytics-dashboard-for-wp"),city:u("City","google-analytics-dashboard-for-wp"),region:u("Region","google-analytics-dashboard-for-wp"),deviceCategory:u("Device Category","google-analytics-dashboard-for-wp"),browser:u("Browser","google-analytics-dashboard-for-wp"),operatingSystem:u("Operating System","google-analytics-dashboard-for-wp"),pagePath:u("Page Path","google-analytics-dashboard-for-wp"),pageTitle:u("Page Title","google-analytics-dashboard-for-wp"),landingPage:u("Landing Page","google-analytics-dashboard-for-wp"),eventName:u("Event Name","google-analytics-dashboard-for-wp"),date:u("Date","google-analytics-dashboard-for-wp"),"customEvent:seo_score":u("SEO Score (Generic)","google-analytics-dashboard-for-wp"),"customEvent:aioseo_truseo_score":u("All in One SEO (TruSEO Score)","google-analytics-dashboard-for-wp"),"customEvent:yoast_seo_score":u("Yoast SEO Score","google-analytics-dashboard-for-wp"),"customEvent:rankmath_seo_score":u("Rank Math SEO Score","google-analytics-dashboard-for-wp")};return t.map(e=>({value:e,label:o[e]||e}))});function x(){v("close")}function M(){v("apply",[k.value]),v("close")}return(l,r)=>(s(),a(f,{to:"body"},[c(h,{name:"modal-fade"},{default:p(()=>[n.isOpen?(s(),e("div",{key:0,class:"exactmetrics-modal-overlay",onClick:b(x,["self"])},[o("div",ye,[o("div",be,[o("button",{class:"exactmetrics-modal-back",onClick:x,"aria-label":d(u)("Back","google-analytics-dashboard-for-wp")},[c(U,{name:"arrow-left",size:16})],8,Ce),o("h3",null,i(d(u)("Customize Breakdown","google-analytics-dashboard-for-wp")),1),o("button",{class:"exactmetrics-modal-close",onClick:x,"aria-label":d(u)("Close","google-analytics-dashboard-for-wp")},[c(U,{name:"close",size:16})],8,_e)]),r[0]||(r[0]=o("div",{class:"exactmetrics-modal-divider"},null,-1)),o("div",ke,[o("p",Se,i(d(u)("Select how you want to break down your data:","google-analytics-dashboard-for-wp")),1),(s(!0),e(C,null,_(S.value,a=>(s(),e("div",{key:a.value,class:"exactmetrics-dimension-option"},[o("label",xe,[o("input",{type:"radio",value:a.value,checked:k.value===a.value,onChange:e=>function(e){k.value=e}(a.value),class:"exactmetrics-radio",name:"dimension"},null,40,Me),o("span",De,i(a.label),1)])]))),128))]),o("div",Oe,[o("button",{class:"exactmetrics-button exactmetrics-button--secondary",onClick:x},i(d(u)("Cancel","google-analytics-dashboard-for-wp")),1),o("button",{class:"exactmetrics-button exactmetrics-button--primary",onClick:M},i(d(u)("Apply","google-analytics-dashboard-for-wp")),1)])])])):t("",!0)]),_:1})]))}},[["__scopeId","data-v-78081b3f"]]),Te={class:"exactmetrics-dashboard-create"},Ve={class:"exactmetrics-page-header"},Le=["title"],Ie={key:0,class:"exactmetrics-saving-overlay"},Re={__name:"DashboardCreate",setup(g){const m=D(),p=x(),v=O(),{hasAccess:h,isSampleMode:f,shouldBlurContent:y,shouldShowUpsell:b,upsellContent:C,hasSampleData:_,openUpsellModal:E,closeUpsellModal:U,enableSampleMode:z}=W("custom-dashboard"),{isAuthenticated:$,showAuthModal:q,showReAuthModal:F,shouldBlurContent:K,openAuthModal:Y,closeAuthModal:H}=T(),{sampleData:J,loadSampleData:Q}=N("custom-dashboard","widgets-data"),{sampleData:X,loadSampleData:Z}=N("custom-dashboard","sample-view"),ee=r(!1),se=r("saved"),ae=k([]),te=k(function(){const e=new Date,s=new Date;return s.setDate(s.getDate()-30),{start:s.toISOString().split("T")[0],end:e.toISOString().split("T")[0],compareStart:"",compareEnd:"",interval:"last30days",compareReport:!1,text:"",compareText:"",intervalText:"",intervalCompareText:""}}());w(ae,()=>{ee.value=!0,se.value="unsaved",ne()},{deep:!0});let oe=null;const ne=()=>{clearTimeout(oe),oe=setTimeout(()=>{Ge()},100)};function le(e){ae.length=0,ae.push(...e)}const re=k({}),de=k({}),ue=l(()=>{var e;return f.value&&(null==(e=X.value)?void 0:e[0])?X.value[0]:v.currentView}),ce=l(()=>f.value&&X.value?X.value:v.allViews),ge=l(()=>{var e;return f.value&&(null==(e=J.value)?void 0:e.widgets)?J.value.widgets:re}),me=l({get:()=>te,set(e){Object.assign(te,e)}}),pe=l(()=>v.isLoading);async function ve(){var e,s;if(z(),null==(s=null==(e=X.value)?void 0:e[0])?void 0:s.layout){ae.length=0;const e=[...X.value[0].layout].sort((e,s)=>3*e.position.y+e.position.x-(3*s.position.y+s.position.x));ae.push(...e)}}async function we(e){var s,a;if(h.value){v.setLoading(!0);try{if(ae.length=0,Object.keys(re).forEach(e=>delete re[e]),Object.keys(de).forEach(e=>delete de[e]),e)if(await v.loadViewForEdit(e),null==(a=null==(s=v.currentView)?void 0:s.layout)?void 0:a.length){const e=[...v.currentView.layout].sort((e,s)=>3*e.position.y+e.position.x-(3*s.position.y+s.position.x));ae.push(...e),await ye()}else v.setLoading(!1);else{const e=p.query.template,s=e?function(e){return{blank:u("Blank Dashboard","google-analytics-dashboard-for-wp"),ecommerce:u("eCommerce Dashboard","google-analytics-dashboard-for-wp"),"small-business":u("Small Business Dashboard","google-analytics-dashboard-for-wp"),publisher:u("Publisher Dashboard","google-analytics-dashboard-for-wp"),marketer:u("Marketer Dashboard","google-analytics-dashboard-for-wp")}[e]||u("My Custom View","google-analytics-dashboard-for-wp")}(e):"";v.createNewView(s),v.setLoading(!1)}}catch(t){v.setLoading(!1)}}}async function he(e){if(e.added){const s=e.added.element;s&&await be(s)}ee.value=!0,ne()}async function ye(){var e,s;if(!ae.length)return void v.setLoading(!1);const a=[];for(let o=0;o<ae.length;o+=5)a.push(ae.slice(o,o+5));v.setLoading(!0),ae.forEach(e=>{e&&e.id&&(de[e.id]=!0)});for(let o=0;o<a.length;o++){const i=a[o];try{const a=await V.getDashboardData(i,te),t=(null==a?void 0:a.widgets)||(null==(e=null==a?void 0:a.data)?void 0:e.widgets),o=(null==(s=null==a?void 0:a.data)?void 0:s.date_range)||(null==a?void 0:a.date_range);t&&Object.keys(t).forEach(e=>{re[e]={...t[e],dateRange:o?{current:{start:o.start,end:o.end},previous:{start:o.compareStart||"",end:o.compareEnd||""}}:null}})}catch(t){i.forEach(e=>{e&&e.id&&(re[e.id]={error:!0,message:t.message})})}finally{i.forEach(e=>{e&&e.id&&(de[e.id]=!1)})}o<a.length-1&&await new Promise(e=>setTimeout(e,300))}v.setLoading(!1)}async function be(e){var s,a;if(e&&e.id){v.setLoading(!0),de[e.id]=!0;try{const t=await V.getDashboardData([e],te),o=(null==t?void 0:t.widgets)||(null==(s=null==t?void 0:t.data)?void 0:s.widgets),i=(null==(a=null==t?void 0:t.data)?void 0:a.date_range)||(null==t?void 0:t.date_range);o&&o[e.id]&&(re[e.id]={...o[e.id],dateRange:i?{current:{start:i.start,end:i.end},previous:{start:i.compareStart||"",end:i.compareEnd||""}}:null})}catch(t){re[e.id]={error:!0,message:t.message}}finally{de[e.id]=!1,v.setLoading(!1)}}}async function Ce(){await ye()}function _e(e){const s=ae.findIndex(s=>(null==s?void 0:s.id)===e);-1!==s&&(ae.splice(s,1),delete re[e],delete de[e],ee.value=!0)}S(async()=>{if($.value){if(!h.value)return E(),void(await Promise.all([Q(),Z(),v.loadWidgetMetadata()]));v.setLoading(!0);try{await Promise.all([v.loadViews(),v.loadWidgetMetadata()]),await we(p.params.id)}catch(e){v.setLoading(!1)}}else Y()}),w(()=>p.params.id,(e,s)=>{e!==s&&we(e)}),M(()=>{ee.value});const ke=r(!1),Se=r(null),xe=l(()=>Se.value?v.getWidgetByType(Se.value.type):null);function Me(e){const s=ae.find(s=>(null==s?void 0:s.id)===e);s&&(Se.value=s,ke.value=!0)}function De(){ke.value=!1,Se.value=null}function Oe({widgetId:e,metrics:s}){const a=ae.findIndex(s=>(null==s?void 0:s.id)===e);-1!==a&&ae[a]&&(ae[a].metrics=s,ee.value=!0,ne(),be(ae[a]))}const Re=r(!1);function je(e){const s=ae.find(s=>(null==s?void 0:s.id)===e);s&&(Se.value=s,Re.value=!0)}function Ae(){Re.value=!1,Se.value=null}function Be(e){if(!Se.value)return;const s=ae.findIndex(e=>(null==e?void 0:e.id)===Se.value.id);-1!==s&&ae[s]&&(ae[s].dimensions=e,ee.value=!0,ne(),be(ae[s]))}function Pe({widgetId:e,chartType:s}){const a=ae.findIndex(s=>(null==s?void 0:s.id)===e);-1!==a&&ae[a]&&(ae[a].displayType=s,ae[a].position||(ae[a].position={x:0,y:0,w:1}),ee.value=!0,ne(),be(ae[a]))}function Ue({widgetId:e,width:s}){const a=ae.findIndex(s=>(null==s?void 0:s.id)===e);-1!==a&&ae[a]&&(ae[a].position||(ae[a].position={x:0,y:0,w:1}),ae[a].position.w=s,ee.value=!0,ne())}function ze(e){const s=ae.findIndex(s=>(null==s?void 0:s.id)===e);-1!==s&&ae[s]&&(ae[s].extendedView=!ae[s].extendedView,ee.value=!0,ne())}function We(e){const s=ae.findIndex(s=>(null==s?void 0:s.id)===e);-1!==s&&ae[s]&&(ae[s].compare=!ae[s].compare,ee.value=!0,ne(),be(ae[s]))}function Ne({widgetId:e,title:s}){const a=ae.findIndex(s=>(null==s?void 0:s.id)===e);-1!==a&&ae[a]&&(ae[a].title=s,ee.value=!0,ne())}async function Ge(){var e;if(h.value&&v.currentView){se.value="saving";try{const s=ae.map((e,s)=>{var a;if(!e)return null;const t=(null==(a=e.position)?void 0:a.w)||1;return{...e,position:{x:s%3,y:Math.floor(s/3),w:t}}}).filter(Boolean);v.currentView.layout=s,await v.saveCurrentView(),ee.value=!1,se.value="saved","dashboard-create"===p.name&&(null==(e=v.currentView)?void 0:e.id)&&m.push({name:"dashboard-edit",params:{id:v.currentView.id}})}catch(s){se.value="error"}}}async function $e({name:e}){v.currentView&&(v.currentView.title=e,ee.value=!0,await Ge())}function qe(e){"new"===e?m.push({name:"dashboard-create"}):m.push({name:"dashboard-view",params:{id:e}})}function Fe(){h.value?m.push({name:"dashboard-add"}):E()}async function Ke(e){try{await v.deleteView(e);const s=v.allViews,a=window.exactmetrics.custom_dashboard_url;s.length>0?window.location.href=`${a}#/dashboards/edit/${s[0].id}`:window.location.href=`${a}#/`}catch(s){}}return(l,r)=>{var g,m;return s(),e("div",Te,[d(f)?(s(),a(P,{key:0,feature:"custom-dashboard"})):t("",!0),c(L,{"all-views":ce.value,"current-view":ue.value,"auto-save-status":se.value,"is-new-view":!d(p).params.id,"allow-reorder":!0,onSelect:qe,onRename:$e,onDelete:Ke,onAddNew:Fe},null,8,["all-views","current-view","auto-save-status","is-new-view"]),o("div",{class:n(["exactmetrics-dashboard-main-content",{"exactmetrics-dashboard-main-content--saving":"saving"===se.value}])},[o("div",{class:n(["exactmetrics-dashboard-main",{"exactmetrics-content-blurred":d(y)||d(K)}])},[o("div",Ve,[o("h1",null,i((null==(g=ue.value)?void 0:g.title)||d(u)("New Dashboard","google-analytics-dashboard-for-wp")),1),o("div",{class:n(["exactmetrics-page-header__actions",{"exactmetrics-page-header__actions--disabled":pe.value}]),title:pe.value?d(u)("Please wait while data is loading...","google-analytics-dashboard-for-wp"):"","data-html2canvas-ignore":"true"},[c(I,{"report-title":null==(m=ue.value)?void 0:m.title,disabled:pe.value},null,8,["report-title","disabled"]),c(d(R),{modelValue:me.value,"onUpdate:modelValue":r[0]||(r[0]=e=>me.value=e),disabled:pe.value,onDateChanged:Ce},null,8,["modelValue","disabled"])],10,Le)]),c(j,{ref:"widgetsGridRef",widgets:ae,"widget-data":ge.value,"widget-loading-states":de,"is-draggable":"saving"!==se.value,"onUpdate:widgets":le,onChange:he,onEnd:ne,onRemove:_e,onConfigure:Me,onEditDimensions:je,onToggleChart:Pe,onResize:Ue,onToggleExtendedView:ze,onToggleComparison:We,onRename:Ne},null,8,["widgets","widget-data","widget-loading-states","is-draggable"])],2),c(ie),"saving"===se.value?(s(),e("div",Ie,[...r[1]||(r[1]=[o("span",{class:"exactmetrics-saving-spinner"},null,-1)])])):t("",!0)],2),c(A,{isOpen:d(q),onClose:d(H)},null,8,["isOpen","onClose"]),c(B,{isOpen:d(F),onClose:d(H)},null,8,["isOpen","onClose"]),c(G,{isOpen:d(b),feature:"custom-dashboard",content:d(C),showSampleButton:d(_),customImage:"sample-image-exactmetrics.png",onClose:d(U),onSeeSample:ve},null,8,["isOpen","content","showSampleButton","onClose"]),c(fe,{"is-open":ke.value,widget:Se.value,"widget-metadata":xe.value,onClose:De,onApply:Oe},null,8,["is-open","widget","widget-metadata"]),c(Ee,{"is-open":Re.value,widget:Se.value,"widget-metadata":xe.value,onClose:Ae,onApply:Be},null,8,["is-open","widget","widget-metadata"])])}}};export{Re as default};
